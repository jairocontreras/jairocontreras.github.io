<link rel=icon href=images/fav_passgen.png>
<link rel=stylesheet href=style/site.css>
<title>Password Generator</title>
<style>
button, input, select {
  font-size: 16; /* same as body */
  padding-bottom: 10;
  padding-top: 10;
}
input, select, .actions {
  border-color: #bcbcbc;
}
input, .actions {
  border-style: solid;
  border-radius: 5px;
  border-width: 1;
}
button {
  cursor: pointer;
}
input:focus, select:focus {
  outline: none;
}
.actions {
  font-size: 15;
  padding-left: 12;
  padding-right: 12;
}
.actions:hover, .copied {
  background: #f7f7f7;
}
.break {
  margin-top: 20;
}
.copied {
  color: green;
}
#generate:hover {
  background: #4095c6 !important;
}
</style>
<main>
  <a href=/></a>
  <p><img src=images/password_generator.png><span style="font-size: 18">Password Generator</span>
  <hr style="margin-bottom: 30; margin-top: 0">
  <div class=flex>
    <select id=number readonly style="padding-left: 10; padding-right: 10; margin-right: 15"></select>
    <button id=generate style="background: #4eb5f1; border: none; border-radius: 20px; color: white; padding-left: 20; padding-right: 20; transition-duration: .2s">Generate</button>
    <div class=break></div>
    <input class=center id=result readonly style="width: 236">
    <div class=break></div>
    <button class=actions id=copy style="margin-right: 8">Copy</button>
    <button class=actions id=clear>Clear</button>
  </div>
</main>
<script>
const alphabet = "abcdefghijklmnopqrstuvwxyz",
      number = document.getElementById("number"),
      generate = document.getElementById("generate"),
      result = document.getElementById("result"),
      copy = document.getElementById("copy"),
      clear = document.getElementById("clear");
var options = "";

for (let i = 1; i < 27; i++) {
  options += "<option>" + i;
}
number.innerHTML += options;

generate.addEventListener("click", function() {
  reset();
  const length = number.value,
        buffer_len = length-1;
  var buffer = "",
      charset = alphabet;
  for (let i = 0; i < buffer_len; i++) {
    while (true) {
      let pos = Math.floor(Math.random() * charset.length),
          strNewTmp = charset.substring(pos, pos+1),
          tmp = buffer.indexOf(strNewTmp);
      if (tmp == -1) {
        buffer += strNewTmp;
        break
      }
      else
        charset = charset.replace(strNewTmp, "");
    }
  }
  charset = alphabet;
  while (true) {
    let pos = Math.floor(Math.random() * charset.length),
        new_tmp = charset.substring(pos, pos+1),
        tmp = buffer.indexOf(new_tmp);
    if (tmp == -1) {
      const insert_pos = Math.floor(Math.random() * buffer_len);
      var _result = buffer.substring(0, insert_pos) + new_tmp + buffer.substring(insert_pos, buffer_len);
      break
    }
    else
      charset = charset.replace(new_tmp, "");
  }
  result.value = _result;
});

copy.addEventListener("click", function() {
  navigator.clipboard.writeText(result.value);
  copy.classList.add("copied");
  copy.innerHTML = "Copied";
  setTimeout(function() {
    reset();
  }, 2000);
});

clear.addEventListener("click", function() {
  result.value = "";
  reset();
});

function reset() {
  copy.classList.remove("copied");
  copy.innerHTML = "Copy";
}
</script>