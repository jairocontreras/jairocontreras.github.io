<script async src=https://www.googletagmanager.com/gtag/js?id=UA-154409978-1></script>
<script src=resources/gtag.js></script>
<link rel=icon href=/images/keys-16.png>
<link rel=stylesheet href=resources/site.css>
<link rel=stylesheet href=https://fonts.googleapis.com/css?family=Roboto>
<title>Password Generator</title>
<style>
button, input {
  font: 16px sans-serif;
}
button, .arrow {
  cursor: pointer;
}
button {
  transition-duration: 0.2s;
}
button:disabled {
  background-color: #ed4337 !important;
}
button:focus, input:focus {
  outline: none;
}
input, .action, .arrow, .arrow::before {
  border-style: solid;
}
input, .action, .arrow {
  border-width: 1;
  border-radius: 5px;
}
input, .action {
  border-color: #bcbcbc;
}
input, .arrow {
  text-align: center;
}
input::-webkit-inner-spin-button {  
  display: none;
}
.action {
  background-color: white;
  font-size: 15;
  padding-left: 10;
  padding-right: 10;
}
.action:not(.copied):hover {
  background-color: #f7f7f7 !important;
}
.arrow {
  background-color: #ccc;
  border-color: #aaa;
  box-shadow: 1px 2px 15px #ccc;
  height: 18;
  width: 18;
}
.arrow::before {
  border-color: #007bff transparent;
  content: "";
  display: inline-block;
  margin-top: 4;
}
.copied {
  background-color: #26c281 !important;
  border-color: #26c281 !important;
  color: white;
  transition-duration: 0.3s !important;
}
.padding {
  padding-bottom: 10;
  padding-top: 10;
}
#down::before, #up::before {
  border-left-width: 5;
  border-right-width: 5;
}
#down::before {
  border-bottom-width: 0;
  border-top-width: 10;
}
#generate:not(:disabled):hover {
  background-color: #4095c6 !important;
}
#up::before {
  border-bottom-width: 10;
  border-top-width: 0;
}
</style>
<main style="padding-bottom: 35">
  <a href=/></a>
  <p><img src=images/keys-24.png style="margin-right: 5">Password Generator
  <div class=flex>
    <input id=number type=number value=1 min=1 max=26 autocomplete=off required style="margin-right: 10">
    <div style="margin-right: 10">
      <div id=up class=arrow style="margin-bottom: 3"></div>
      <div id=down class=arrow></div>
    </div>
    <button id=generate style="background-color: #4eb5f1; border: none; border-radius: 20px; color: white; padding-left: 20; padding-right: 20; user-select: none">Generate</button>
    <div class=break style="margin-bottom: 25"></div>
    <input id=result autocomplete=off readonly class=padding style="margin-right: 5; width: 236">
    <button id=copy class="action padding" style="margin-right: 5">Copy</button>
    <button id=clear class="action padding">Clear</button>
  </div>
</main>
<script>
const alphabet = "abcdefghijklmnopqrstuvwxyz",
      arrows = ["down", "up"],
      clear = document.getElementById("clear"),
      copy = document.getElementById("copy"),
      generate = document.getElementById("generate"),
      number = document.getElementById("number");

function reset() {
  copy.classList.remove("copied");
  copy.innerHTML = "Copy";
}

number.addEventListener("input", function() {
  generate.disabled = (this.validity.valid ? false : true);
});

arrows.forEach(function(item) {
  document.getElementById(item).addEventListener("click", function() {
    if ((item == "down" && number.value < 2) || (item == "up" && number.value > 25))
      return
    (item == "down" ? number.value-- : number.value++);
    number.dispatchEvent(new Event("input"));
  });
});

generate.addEventListener("click", function() {
  reset();
  const length = document.querySelector("input").value,
        buffer_len = length-1;
  var buffer = "",
      charset = alphabet;
  for (let i = 0; i < buffer_len; i++) {
    while (true) {
      let pos = Math.floor(Math.random() * charset.length),
          strNewTmp = charset.substring(pos, pos+1),
          tmp = buffer.indexOf(strNewTmp);
      if (tmp == -1) {
        buffer += strNewTmp;
        break
      }
      else
        charset = charset.replace(strNewTmp, "");
    }
  }
  charset = alphabet;
  while (true) {
    let pos = Math.floor(Math.random() * charset.length),
        new_tmp = charset.substring(pos, pos+1),
        tmp = buffer.indexOf(new_tmp);
    if (tmp == -1) {
      const insert_pos = Math.floor(Math.random() * buffer_len);
      var result = buffer.substring(0, insert_pos) + new_tmp + buffer.substring(insert_pos, buffer_len);
      break
    }
    else
      charset = charset.replace(new_tmp, "");
  }
  document.getElementById("result").value = result;
});

copy.addEventListener("click", function() {
  navigator.clipboard.writeText(document.getElementById("result").value);
  copy.classList.add("copied");
  copy.innerHTML = "Copied";
  setTimeout(function() {
    reset();
  }, 3000);
});

clear.addEventListener("click", function() {
  result.value = "";
});
</script>